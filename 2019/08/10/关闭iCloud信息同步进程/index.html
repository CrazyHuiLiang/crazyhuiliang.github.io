<!DOCTYPE html><html lang="ch"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="description" content="技术笔记 前端开发"><title>编程小记</title><link rel="stylesheet" href="/styles/layout-bundle.css"><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?3ee29108db650b60a69ef622a9cbefeb";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><meta name="generator" content="Hexo 6.2.0"><link rel="alternate" href="/atom.xml" title="编程小记" type="application/atom+xml"></head><body><div class="main"><link rel="stylesheet" href="/styles/post-bundle.css"><div class="post-page"><h1>关闭iCloud信息同步进程</h1><p class="create-time">发布时间：2019/08/10</p><article class="content"><p>一天工作结束后，略感疲惫，漫步走进地铁，塞上耳塞进入一个人的世界，《Auld Lang Syne》在身体中缓缓流过，舒缓的节奏、磁性的嗓音、以及让心暖心的歌词让人感觉精神渐渐充盈。反复享受多遍后仍不过瘾，我决定要打印出这个歌词好好学习一下。</p><p>回家后，作为一个家中没有WiFi的贫苦青年，只能用手机开一个 <strong>个人热点</strong> 给mac使用，打开mac，打开音乐播放器，兴致冲冲的找到歌曲，点击播放，然后… 音乐播放了5秒就停住了，等十几秒后再次播放，然后秒秒钟后再次停住，显示加载。一声苦叹，生活苦啊，没有WiFi的孩子苦啊，上不了网啊… 正准备关掉手机热点时发现，手机上显示速度是每秒1M多，纳尼？不对头啊，每秒1M的实际速度不够听一首歌的？</p><p>打开’活动监视器‘检查一下网络，如下图</p><img src="/2019/08/10/%E5%85%B3%E9%97%ADiCloud%E4%BF%A1%E6%81%AF%E5%90%8C%E6%AD%A5%E8%BF%9B%E7%A8%8B/evil.png" title="罪证"><p>不出所料有进程抢占了我的流量资源啊，按照已接收字节倒叙排序，发现一个叫做 <strong>nsurlsessiond</strong> 的进程在疯狂的占用带宽，搜索一下，发现他是macOS 10.10系统新加的中文翻译为“互联互通”的功能，主要用于iCloud的同步数据。</p><p>罪魁祸首就是他了，就目前我的需求来看，苹果的iCloud显然不如我的正常网络访问重要，搜索一下，找到以下命令来关闭 <strong>nsurlsessiond</strong> 的运行、自动启动</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line">launchctl unload /System/Library/LaunchDaemons/com.apple.nsurlstoraged.plist</span><br><span class="line">launchctl unload /System/Library/LaunchAgents/com.apple.nsurlsessiond.plist</span><br><span class="line">sudo launchctl unload /System/Library/LaunchDaemons/com.apple.nsurlsessiond.plist</span><br><span class="line">sudo launchctl unload /System/Library/LaunchDaemons/com.apple.nsurlstoraged.plist</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>Shell中执行上面所述命令后报一个错误：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Operation not permitted while System Integrity Protection is engaged</span><br></pre></td></tr></table></figure><p>看样子这厮还有保护伞，如此的流氓就必须打掉，继续搜索应对措施，发现这是mac系统的一种名为<strong>系统完整性保护</strong>的约束。关闭约束的步骤：</p><ol><li>进入系统的恢复模式（关机，再次开机按住command + r）</li><li>在页面菜单中点击<strong>实用工具</strong>，点击<strong>终端</strong></li><li>执行命令 <code>csrutil disable</code></li><li>关机重启</li></ol><p>OK,现在保护伞关掉了，开机后重新执行上面的关闭 <strong>nsurlsessiond</strong> 命令就可以成功了。</p><h2 id="最后补充"><a href="#最后补充" class="headerlink" title="最后补充"></a>最后补充</h2><p><strong>系统完整性保护</strong>是系统的一种安全机制，正常情况不建议关闭，如需开启，开启的指令是：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">同样需要在系统的恢复模式执行：</span><br><span class="line">csrutil enable</span><br></pre></td></tr></table></figure><p>同样，日后哪天需要再和 <strong>nsurlsessiond</strong> 共事时，执行下面指令：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">launchctl load /System/Library/LaunchDaemons/com.apple.nsurlstoraged.plist</span><br><span class="line">launchctl load /System/Library/LaunchAgents/com.apple.nsurlsessiond.plist</span><br><span class="line">sudo launchctl load /System/Library/LaunchDaemons/com.apple.nsurlsessiond.plist</span><br><span class="line">sudo launchctl load /System/Library/LaunchDaemons/com.apple.nsurlstoraged.plist</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="参考："><a href="#参考：" class="headerlink" title="参考："></a>参考：</h2><blockquote><p><a target="_blank" rel="noopener" href="https://discussionschinese.apple.com/thread/140132285?answerId=140315426322#140315426322">https://discussionschinese.apple.com/thread/140132285?answerId=140315426322#140315426322</a><br><a target="_blank" rel="noopener" href="https://www.chadou.me/p/193">https://www.chadou.me/p/193</a><br><a target="_blank" rel="noopener" href="https://www.technipages.com/macos-system-integrity-protection">https://www.technipages.com/macos-system-integrity-protection</a></p></blockquote></article><p class="last-update">最后更新：2022/06/30</p></div><script src="/scripts/post-bundle.js"></script></div><footer class="site-footer"><section><p>欢迎交流</p><address>Email: <a href="mailto:crazyhuiliang@163.com">crazyhuiliang@163.com</a></address><address>Github: <a target="_blank" rel="noopener" href="https://github.com/CrazyHuiLiang">https://github.com/CrazyHuiLiang</a></address></section></footer></body></html>